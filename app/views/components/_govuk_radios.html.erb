<%
   id_prefix = local_assigns[:idPrefix] || local_assigns[:name]
   described_by = ""
   is_conditional = items.any? { |item| item[:conditional] }
%>

<% radios_html = capture do %>
  <% if local_assigns[:hint] %>
    <%
      hint_id = id_prefix + '-hint'
      described_by = described_by.present? ? described_by + ' ' + hint_id : hint_id
    %>
    <%= govukHint({
      id: hint_id,
      classes: local_assigns[:hint][:classes],
      attributes: local_assigns[:hint][:attributes],
      html: local_assigns[:hint][:html],
      text: local_assigns[:hint][:text]
      }) %>
  <% end %>

  <% radio_classes = class_names(
      "govuk-radios",
      { "govuk-radios--conditional" => is_conditional },
      local_assigns[:classes]
  )
  %>
  <% radio_attributes = {class: radio_classes}.merge!(local_assigns[:attributes] || {}) %>

  <%= tag.div(**radio_attributes) do %>
    <% local_assigns[:items].each_with_index do |item, index| %>
      <%
        id = item[:id] || "#{id_prefix}-#{index}"
        conditional_id = 'conditional-' + id
      %>
      <% if item[:divider] %>
        <div class="govuk-radios__divider"><%= item.divider %></div>
      <% else %>
        <%
          has_hint = item[:hint] && (item[:hint][:text] || item[:hint][:html])
          item_hint_id = id + '-item-hint'
          disabled = item
          input_attributes = {
            id: id,
            name: local_assigns[:name],
            type: "radio",
            value: item[:value],

          }

          input_attributes.merge({disabled: "disabled"}) if item[:disabled]
          input_attributes.merge({checked: "checked"}) if item[:checked]
          input_attributes.merge({"data-aria-controls" => conditional_id}) if item[:conditional]
          input_attributes.merge({"aria-describeby" => item_hint_id}) if has_hint
        %>
        <%
          label_classes = class_names(
            'govuk-radios__label',
            { item[:label].try([], :classes) =>  item[:label] }
          )
        %>
        <div class="govuk-radios__item">
          <%= tag.input(**input_attributes) %>
          <%=
            govukLabel({
                html: item[:html],
                text: item[:text],
                classes: label_classes,
                attributes: item[:label].try([], :attributes),
                for: item[:id]
            })
          %>

          <% if has_hint %>
            <%=
              govukHint({
                id: itemHintId,
                classes: 'govuk-radios__hint',
                attributes: item.hint.attributes,
                html: item.hint.html,
                text: item.hint.text
              })
            %>
          <% end %>
      <% end %>
      </div>
    <% end %>
  <% end %>
<% end %>
<%= radios_html %>
